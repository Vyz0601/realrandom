{"version":3,"file":"createBaseQuery.mjs","sources":["../../src/createBaseQuery.ts"],"sourcesContent":["import type {\n  QueryClient,\n  QueryFunctionContext,\n  UseBaseQueryOptions,\n  UseInfiniteQueryOptions,\n} from '@tanstack/react-query'\n\nimport { getKey as getFullKey, withMiddleware } from './utils'\n\ntype QueryBaseHookOptions = Omit<\n  UseBaseQueryOptions,\n  'queryKey' | 'queryFn'\n> & {\n  fetcher?: any\n  variables?: any\n}\n\nexport const createBaseQuery = (\n  defaultOptions: any,\n  useRQHook: (options: any, queryClient?: any) => any,\n  overrideOptions?: Partial<UseInfiniteQueryOptions>\n): any => {\n  if (process.env.NODE_ENV !== 'production') {\n    // @ts-ignore\n    if (defaultOptions.useDefaultOptions) {\n      console.error(\n        '[Bug] useDefaultOptions is not supported, please use middleware instead.'\n      )\n    }\n\n    // @ts-ignore\n    if (defaultOptions.queryFn) {\n      console.error(\n        '[Bug] queryFn is not supported, please use fetcher instead.'\n      )\n    }\n  }\n\n  const getQueryOptions = (fetcherFn: any, variables: any) => {\n    return {\n      queryFn: (context: QueryFunctionContext) => fetcherFn(variables, context),\n      queryKey: getFullKey(defaultOptions.queryKey, variables),\n    }\n  }\n\n  const getKey = (variables?: any) =>\n    getFullKey(defaultOptions.queryKey, variables)\n\n  const getOptions = (variables: any) => {\n    return {\n      ...defaultOptions,\n      ...getQueryOptions(defaultOptions.fetcher, variables),\n    }\n  }\n\n  const getFetchOptions = (variables: any) => {\n    return {\n      ...getQueryOptions(defaultOptions.fetcher, variables),\n      queryKeyHashFn: defaultOptions.queryKeyHashFn,\n      getPreviousPageParam: defaultOptions.getPreviousPageParam,\n      getNextPageParam: defaultOptions.getNextPageParam,\n      initialPageParam: defaultOptions.initialPageParam,\n    }\n  }\n\n  const useBaseHook = (\n    options: QueryBaseHookOptions,\n    queryClient?: QueryClient\n  ) => {\n    return useRQHook(\n      {\n        ...options,\n        ...getQueryOptions(options.fetcher, options.variables),\n        ...overrideOptions,\n      },\n      queryClient\n    )\n  }\n\n  return Object.assign(withMiddleware(useBaseHook, defaultOptions, 'queries'), {\n    fetcher: defaultOptions.fetcher,\n    getKey,\n    getOptions,\n    getFetchOptions,\n  })\n}\n"],"names":["createBaseQuery","defaultOptions","useRQHook","overrideOptions","process","env","NODE_ENV","useDefaultOptions","console","error","queryFn","getQueryOptions","fetcherFn","variables","context","queryKey","getFullKey","getKey","getOptions","fetcher","getFetchOptions","queryKeyHashFn","getPreviousPageParam","getNextPageParam","initialPageParam","useBaseHook","options","queryClient","Object","assign","withMiddleware"],"mappings":";;AAiBO,MAAMA,eAAe,GAAG,CAC7BC,cAD6B,EAE7BC,SAF6B,EAG7BC,eAH6B,KAIrB;AACR,EAAA,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzC;IACA,IAAIL,cAAc,CAACM,iBAAnB,EAAsC;MACpCC,OAAO,CAACC,KAAR,CACE,0EADF,CAAA,CAAA;AAGD,KANwC;;;IASzC,IAAIR,cAAc,CAACS,OAAnB,EAA4B;MAC1BF,OAAO,CAACC,KAAR,CACE,6DADF,CAAA,CAAA;AAGD,KAAA;AACF,GAAA;;AAED,EAAA,MAAME,eAAe,GAAG,CAACC,SAAD,EAAiBC,SAAjB,KAAoC;IAC1D,OAAO;MACLH,OAAO,EAAGI,OAAD,IAAmCF,SAAS,CAACC,SAAD,EAAYC,OAAZ,CADhD;AAELC,MAAAA,QAAQ,EAAEC,MAAU,CAACf,cAAc,CAACc,QAAhB,EAA0BF,SAA1B,CAAA;KAFtB,CAAA;GADF,CAAA;;EAOA,MAAMI,QAAM,GAAIJ,SAAD,IACbG,MAAU,CAACf,cAAc,CAACc,QAAhB,EAA0BF,SAA1B,CADZ,CAAA;;EAGA,MAAMK,UAAU,GAAIL,SAAD,IAAoB;IACrC,OAAO,EACL,GAAGZ,cADE;AAEL,MAAA,GAAGU,eAAe,CAACV,cAAc,CAACkB,OAAhB,EAAyBN,SAAzB,CAAA;KAFpB,CAAA;GADF,CAAA;;EAOA,MAAMO,eAAe,GAAIP,SAAD,IAAoB;IAC1C,OAAO,EACL,GAAGF,eAAe,CAACV,cAAc,CAACkB,OAAhB,EAAyBN,SAAzB,CADb;MAELQ,cAAc,EAAEpB,cAAc,CAACoB,cAF1B;MAGLC,oBAAoB,EAAErB,cAAc,CAACqB,oBAHhC;MAILC,gBAAgB,EAAEtB,cAAc,CAACsB,gBAJ5B;MAKLC,gBAAgB,EAAEvB,cAAc,CAACuB,gBAAAA;KALnC,CAAA;GADF,CAAA;;AAUA,EAAA,MAAMC,WAAW,GAAG,CAClBC,OADkB,EAElBC,WAFkB,KAGf;AACH,IAAA,OAAOzB,SAAS,CACd,EACE,GAAGwB,OADL;MAEE,GAAGf,eAAe,CAACe,OAAO,CAACP,OAAT,EAAkBO,OAAO,CAACb,SAA1B,CAFpB;MAGE,GAAGV,eAAAA;KAJS,EAMdwB,WANc,CAAhB,CAAA;GAJF,CAAA;;AAcA,EAAA,OAAOC,MAAM,CAACC,MAAP,CAAcC,cAAc,CAACL,WAAD,EAAcxB,cAAd,EAA8B,SAA9B,CAA5B,EAAsE;IAC3EkB,OAAO,EAAElB,cAAc,CAACkB,OADmD;YAE3EF,QAF2E;IAG3EC,UAH2E;AAI3EE,IAAAA,eAAAA;AAJ2E,GAAtE,CAAP,CAAA;AAMD;;;;"}